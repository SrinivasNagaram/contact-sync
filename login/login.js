!function(e){"use strict";e.module("MyContactsApp.login",["firebase.utils","firebase.auth","ngRoute","jcs-autoValidate"]).config(["$routeProvider",function(e){e.when("/login",{controller:"LoginCtrl",templateUrl:"login/login.html",title:"My Contacts | Log In"})}]).controller("LoginCtrl",["$rootScope","$scope","Auth","$location","fbutil","$timeout",function(n,r,t,i,l,o){function a(){r.err=!1,r.emailErr=!1,r.emailSuccess=!1}function s(){return r.email?r.pass&&r.confirm?r.createMode&&r.pass!==r.confirm&&(r.err="Passwords do not match"):r.err="Please enter a password":r.err="Please enter an email address",!r.err}function u(n){return e.isObject(n)&&n.code?n.code:n+""}function c(e){return m(e.substr(0,e.indexOf("@"))||"")}function m(e){e+="";var n=e.charAt(0).toUpperCase();return n+e.substr(1)}r.loginTitle="Sign In",r.email=null,r.pass=null,r.confirm=null,r.createMode=!1,r.forgetMode=!0,r.register=function(){r.loginTitle="Create Account",r.err=!1,r.forgetMode=!0,r.createMode=!0,null===r.email||null===r.pass||null===r.confirm?r.submitting=!1:r.submitting=!0},r.cancelUser=function(){r.loginTitle="Sign In",r.createMode=!1,r.err=!1},r.login=function(e,n){o(a,3500),r.err=null,r.submitting=!0,null===r.email&&null===r.pass&&(r.submitting=!1),t.$authWithPassword({email:e,password:n},{rememberMe:!0}).then(function(){i.path("/home"),r.submitting=!1},function(e){r.err=u(e),(null===r.email||null===r.pass)&&(r.err=!1),null!==r.email&&null!==r.pass&&(r.err=u(e),"INVALID_USER"===r.err&&(r.err="Invalid email"),"INVALID_PASSWORD"===r.err&&(r.err="Invalid password"),r.email||(r.err="Please enter a valid email address"))})},r.createAccount=function(){if(o(a,3500),r.forgetMode=!0,r.err=null,null===r.email||null===r.pass||null===r.confirm?r.submitting=!1:r.submitting=!0,s()){var e=r.email,n=r.pass;t.$createUser({email:e,password:n}).then(function(){return r.submitting=!1,t.$authWithPassword({email:e,password:n})}).then(function(n){var r=l.ref("users",n.uid),t={google:{},facebook:{},twitter:{},linkedin:{},other:{}},i="assets/img/fallbackImg.jpg";return l.handler(function(n){r.set({email:e,name:name||c(e),profilepic:i,friends:t},n)})}).then(function(){i.path("/home")},function(e){})}},r.resetUserPassword=function(e){void 0!==e&&t.$resetPassword({email:e.email}).then(function(){r.emailSuccess="Password reset email sent successfully!",r.forgetMode=!0})["catch"](function(e){r.emailErr=u(e),"INVALID_USER"===r.emailErr&&(r.emailErr="Invalid User")}),o(a,4e3)},r.forgetPass=function(){r.forgetMode=!1}}])}(angular);